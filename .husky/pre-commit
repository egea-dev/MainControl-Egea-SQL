#!/bin/sh

echo "ğŸ” Iniciando validaciones de seguridad y cÃ³digo..."

# 1. Escaneo de secretos (si gitleaks estÃ¡ instalado)
if command -v gitleaks > /dev/null 2>&1; then
  echo "ğŸ” Escaneando secretos con gitleaks..."
  gitleaks protect --staged --verbose || {
    echo "âŒ Se detectaron secretos en el cÃ³digo. Commit bloqueado."
    exit 1
  }
fi

# 2. Linting
echo "ğŸ“ Ejecutando linter..."
npm run lint || {
  echo "âŒ Errores de linting encontrados."
  exit 1
}

# 3. Type checking
echo "ğŸ”· Verificando tipos TypeScript..."
npm run type-check || {
  echo "âŒ Errores de TypeScript encontrados."
  exit 1
}

# 4. Build de prueba (garantiza que no falle en Coolify)
echo "ğŸ—ï¸ Simulando build de producciÃ³n..."
npm run build || {
  echo "âŒ El build fallÃ³ localmente. Commit bloqueado."
  exit 1
}

echo "âœ… Todas las validaciones pasaron. Commit permitido."
